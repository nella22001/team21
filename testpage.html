<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <title>AJAX</title>
</head>
<body>
    <!--koko helahoito scriptin sisällä lähettää http pyynnön-->
    <script>
function lahetaResepti(lomake){
	var resepti=new Object();
    resepti.nimi=resepti.nimi.value;
    resepti.ainekset=lomake.ainekset.value;
	resepti.ohje=lomake.ohje.value;
	var jsonResepti=JSON.stringify(resepti);
	jsonkentta.innerHTML=jsonResepti;

	xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
	  if (this.readyState == 4 && this.status == 200) {
		    document.getElementById("result").innerHTML = this.responseText;
            haeomatreseptit(); //jotta muutos päivittyisi heti tauluun
	  }
	};
	xmlhttp.open("POST", "./lisaaresepti.php", true);
	xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	xmlhttp.send("resepti=" + jsonResepti);

}
//buttonilla on funktio, mikä tulostaa 
function haeomatreseptit() { //funktio buttonia varten, jotta button toimii
    xmlhttp = new XMLHttpRequest(); //osaa tehdä requestin
	xmlhttp.onreadystatechange = function() {
	  if (this.readyState == 4 && this.status == 200) {
		    document.getElementById("result").innerHTML = this.responseText; //result paikassa tulostaa kaikki teksti, mitä löytyi
	  }
	};
	xmlhttp.open("GET", "./haeomatreseptit.php", true); //tämä ainoastaan hakee reseptit tietokannasta, ei itsessään tulosta mitään
	xmlhttp.send();	
}
function haeyksiresepti(indeksi) {
    xmlhttp = new XMLHttpRequest(); //osaa tehdä requestin
	xmlhttp.onreadystatechange = function() {
	  if (this.readyState == 4 && this.status == 200) {
		    document.getElementById("muokattava").innerHTML = this.responseText; //result paikassa tulostaa kaikki teksti, mitä löytyi
            resepti=JSON.parse(this.responseText);
            reseptilomake.nimi.value=resepti.nimi;
            reseptilomake.ainekset.value=resepti.ainekset;
            reseptilomake.ohje.value=resepti.ohje;
        }
	};
	xmlhttp.open("GET", "./haeyksiresepti.php?muokattava="+indeksi, true); //tämä hakee indeksin perusteella muokattavaksi ??????
	xmlhttp.send();	
}
</script>

<h2>Kerro tieto</h2>
<form id='reseptilomake'>
    Reseptin nimi: <input type='text' name='id' value='' placeholder='reseptin nimi...' ><br>
    Ainekset: <input type='textarea' name='ainekset' value='' placeholder='ainekset...'><br>
    Ohje: <input type='textarea' name='ohje' value='' placeholder='valmistusohje...'><br><br>
<input type='button' name='ok' value='Submit' onclick='lahetaResepti(this.form);'><br>
</form>
<button onclick="haeomatreseptit();">Näytä kaikki reseptit</button><br><br>
    <div id='muokattava'>
        id=muokattava palaute tulee tähän
    </div>
<br>
    <div id='result'>
        id=result palaute tulee tähän
    </div>
<br>
    <div id='jsonkentta'>
        jsokentta palaute tulee tähän
    </div>
<br>
</body>
<!--parametri lomake tietää kaiken allaolevasta formista, this.form tarkoittaa kaikkea, mitä form tagien sisällä on-->
<!-- lomakkeen tiedot poimitaan javascriptin oliolle var Koira=new Object(); sille annetaan atribuutteja lomakkeesta-->
<!--ajaxia javascriptilla kirjoitettuna-->

</html>